# encoding: tarantool
#
# backup default
from os.path import abspath
from time import sleep
 

server.stop()
server.install(True)
os.unlink("var/tarantool.cfg")
os.symlink(abspath("box/tarantool_expire.cfg"), "var/tarantool.cfg")
server.start(True)

# select from empty storage
exec sql 'select * from t0 where k0 = 1'
exec sql 'select * from t0 where k0 = 2'
exec sql 'select * from t0 where k0 = 3'

# insert into storage
exec sql "insert into t0 values (1, 'a', 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15)"
exec sql "insert into t0 values (2, 'b', 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15)"
exec sql "insert into t0 values (3, 'c', 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15)"

# verify data
exec sql 'select * from t0 where k0 = 1'
exec sql 'select * from t0 where k0 = 2'
exec sql 'select * from t0 where k0 = 3'

# wait and reselect
sleep(2)

exec sql 'select * from t0 where k0 = 1'
exec sql 'select * from t0 where k0 = 2'
exec sql 'select * from t0 where k0 = 3'

exec sql "select * from t1 where k0 = 'a'"
exec sql "select * from t1 where k0 = 'b'"
exec sql "select * from t1 where k0 = 'c'"


server.stop()
server.install(True)
server.start(True)

# vim: syntax=python

# Local Variables:
# mode: python
# End:
